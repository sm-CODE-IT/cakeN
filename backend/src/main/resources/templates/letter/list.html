<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://kit.fontawesome.com/06a654967f.js" crossorigin="anonymous" defer></script>

    <style>
        button {
            border: none;
            background: none;
        }
        button:focus,
        button:active {
            outline: none;
            box-shadow: none;
        }
        .heartBtn {
            width: 30px;
        }
    </style>
</head>
<body>
<div class="main">
    <a href="/letter/register" class="register">문구 등록</a>
    <table>
        <thead>
        <tr>
            <th>문구 목록</th>
            <th>내용</th> <!-- 임시로 테스트 하기 위함 -->
            <th>태그</th> <!-- 임시로 테스트 하기 위함 -->
            <th>좋아요</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="letter : ${letters}">

            <div th:if="${letter.getTag().toString().equals('BIRTHDAY')}">
                <!-- 1. 문구에 하이퍼링크가 없는 경우 -->
                <a th:href="@{'/letter/detail/' + ${letter.letterId}}"><td th:text="${letter.letterId}"></td></a>
                <!-- 2. 문구에 하이퍼링크가 있는 경우(보류) -->
                <td th:text="${letter.content}"></td>
                <td th:text="${letter.tag}"></td>
                <td th:each="heart : ${hearts}">
                    <button th:if="${heart.letter.content} == ${letter.content}" th:onclick="onClickHeart([[${letter.letterId}]])">
                        <svg class="heartBtn" width="61" height="56" viewBox="0 0 61 56" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16.75 3C9.15725 3 3 9.21302 3 16.8784C3 23.0661 5.40625 37.752 29.092 52.5976C29.5163 52.8608 30.0034 53 30.5 53C30.9966 53 31.4837 52.8608 31.908 52.5976C55.5938 37.752 58 23.0661 58 16.8784C58 9.21302 51.8428 3 44.25 3C36.6573 3 30.5 11.4111 30.5 11.4111C30.5 11.4111 24.3427 3 16.75 3Z" fill="#FFC0CB" stroke="#FFC0CB" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>

                    </button>
                    <button th:if="${heart.letter.content} != ${letter.content} and ${letter.content}" th:onclick="onClickUnheart([[${letter.letterId}]])">
                        <svg class="heartBtn" width="61" height="56" viewBox="0 0 61 56" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16.75 3C9.15725 3 3 9.21302 3 16.8784C3 23.0661 5.40625 37.752 29.092 52.5976C29.5163 52.8608 30.0034 53 30.5 53C30.9966 53 31.4837 52.8608 31.908 52.5976C55.5938 37.752 58 23.0661 58 16.8784C58 9.21302 51.8428 3 44.25 3C36.6573 3 30.5 11.4111 30.5 11.4111C30.5 11.4111 24.3427 3 16.75 3Z" stroke="#FFC0CB" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </td>
            </div>

            <div th:if="${letter.getTag().toString().equals('ANNIVERSARY')}">

            </div>

        </tr>
        </tbody>
    </table>
</div>

<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script>
    function onClickHeart(letterId) {
        var url = '*[[@{/api/heart}]]';
        var headers = {"Content-Type": "application/json", "X-HTTP-Method-Override": "POST"};
        var params = {"letterId": letterId, "userId": user.userId};

        $.ajax({
            url: url,
            type: "POST",
            headers: headers,
            datatype: "json",
            data: JSON.stringify(params),
            success: function(response) {
                if (response.result == false) {
                    console.log("error");
                    return false;
                }
            },
            error: function (xhr, status, error) {
                console.log("error");
                return false;
            }
        });
    }
</script>

</body>
</html>